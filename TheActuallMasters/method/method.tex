\section{Method: Better section header}
	In this section we will introduce the overall approach to the research. First introducing the data set and experimental environment, before going through technicalities in the methods used to represent physical and chemical properties of the electrode materials.

	The two most crucial challenges in ML are; Create the dataset, which needs to be big enough and as accurate as possible to better the predictions given the right features. Secondly, finding the right descriptors. If not both of these conditions are fulfilled, then it is not possible to create a reliable ML model. \myworries{Put in ML part?}
	
	All codes are written in Python 3.7 \cite{van1995python} or Fortran98 \cite{backus1964fortran} and can be found here: \url{https://github.com/sondrt/Creten_Stuff} \myworries{gitrep private, change?}. And all computations are done on a (give computer specifics.), if nothing else is noted \myworries{Any libraries that uses this? read machine architecture. }. The main frameworks and libraries we used for our data mining and data analysis are Python with NumPy \cite{oliphant2006guide}, JSON \cite{pezoa2016foundations}, Pandas \cite{mckinney-proc-scipy-2010}, and Scikit-learn \cite{scikit-learn}.
To make the AP-RDF files Fortran90 was used. 

\subsection{Data set and Experimental Environment}\label{sec:experimentalenv}
%Introduce the overall approach to the research. 

	 The techniques used in this work are the \textit{volumetric number density} (\ac{vnd}), the \textit{Void fraction} (\ac{vf}) and the \textit{atomic property weighted radial distribution function}(\ac{AP-RDF}). Other properties used where introduces in the foundation section \ref{sec:msp}. Lastly we quickly mentions the basics of our algorithm. 
%	Wanted to explore the possibility of using machine learning(ML) to predict different characteristics of batteries, based on their cathode and anode materials.
 

	 The first needed for this task was a database(\ac{db}), we found several, but opted into \textit{materialsproject} \cite{Jain2013} \cite{doi:10.1038/sdata.2015.9} (mp), due to their investment in the battery explorer (\url{www.materialsproject.org/batteries}) \cite{Zhou2004a} \cite{Adams2011a}, which made, the otherwise main task of this work, collecting the data, much easier, and a functioning API \cite{Ong_2015}. The db has a sizable amount of information on electrodes available. MP has $16128$ conversion electrode and $4401$ intercalation electrodes. We decided to limit the project to the intercalation electrodes, due to this limiting the variation of materials in the db. 
	 
	 First of all mp had the reduced cell formula with consistent CIF files for all voltage pairs, that is; both the charged and discharged material. Secondly many different characteristics or voltage pair properties are present. Some of these characteristics, that we used as targets in this work, are; Average voltage, Gravimetric and volumetric Capacity, Specific Energy $(\si{Wh/kg})$, Energy density $(\si{Wh/l}Â )$, and a measurement of the stability; energy above hull measured in  $\si{eV/atom}$. Other properties that where in the mp db and to some extent tested as predictors for each material, both charged, and discharged are; the space group, energy per atom, volume of the unit cell, volume change in percentage, band gap, density, total magnetization, number of sites, and elasticity. 

The database contains more than $4400$ intercalation electrodes, where we have used $2291$ Lithium-ion batteries, and $360$ Magnesium-ion batteries, for our analysis. This could easily be expanded to the $321$ Natrium-ion batteries, and $481$ Calcium-ion batteries in the db. With new compounds being added to the database continuously, including many new structural predictors, there is a high likelihood of an increase in accuracy over time, due to the db growing. Our method were tested on Mg-intercalation electrodes as well as Li-intercalation electrodes, then compared to each other to identify correlations on the valuableness of our predictors. 

	It is important to note that we have a minimum of two predictor per property of the material at any given run. This is due to how we defined each battery. They have at least one charged and one discharged state, and only one target(ref to theory machine learning). For any given property we have one value calculated for the charged material, and one for the discharged material.This means that we predict for a specific charged- or discharged half cell configuration.

	Exemplified by the battery $\ce{Mg(CrS_2)_2}$ with the battery ID: $mvc-1200000091$, it has two material ID's, one for the discharged- ($mvc-91$)\label{ex:MgCrS22-discharged}, and one for the charged($mvc-14769$) \label{ex:MgCrS22-charged} material. This pair will be referred to in this section. 
	
	The sum of features that uniquely represent each compound in the Li data set are $238$ and $177$ for the Mg data set. The feature vectors are vastly different and their numerical values ranges from the thousands down to small fractions. Therefor these were normalized for better prediction capability, for faster training of the model and to avoid any bias preference for a particular feature. The input was normalized to be between $-1$ and $1$, it were done while training our model, and the target values $y$ where not normalized. 


\subsection{Volumetric number density } \label{sec:volumetric_number_density}

	Volumetric number density, \textit{n}, is used to describe concentration of countable objects. And is defined as: 
	
\begin{equation}\label{eq:n}
n= \frac{\#\text{ of atoms}}{\text{Volume of the unit cell}}
\end{equation}

	Where \textit{Volume} is the volume of the unit cell. \myworries{write volume of unit cell in formula?}
	
	Technically, in the volumetric number density, there is a predictor for each individual element. That is; if the intercalation battery framework is $\ch{Mg(CrS_2)_2}$ then the the number density for; magnesium, chromium, and oxygen, related only to that material, will be predictors. The charged material will have the predictors with the values: $S_{vol} = 36.6292$ and $Cr_{vol} = 18.3150 $. While the discharged material will have the predictors with the values: $S_{vol-dis} = 30.1286$, $Cr_{vol-dis} =18.3150 $, and $Mg_{vol-dis} = 7.5321$. All other elements still exists as predictors for this framework, both charged and discharged, and exist as possible branches in the decision threes, but they are given the value $0$. This quality is uniq for the volumetric number density, and all other predictors minimize "empty" columns. 

It is probable that such a direct measurement of a geometrical aspect could be a good predictor due to the physical significants of the information. If RF were applied on to the entirety of the CIF file, it is probable that it would make a bad fit, due to the bias-Variance-trade-off as mentioned in section \ref{sec:Bias-variance tradeoff}, and because of the difference in complexity of some of these files. \myworries{ref to two vastly different files in the appendix or on github?}




\pagebreak
%--------------------------------------------------------------------------------
\subsection{Void Fraction} \label{sec:Void_Fraction}
\myworries{rewrite}

	Void Fraction, or the porosity, is a measurement of the void space in the material. Calculations are based on classical force fields that describe interatomic interactions between the atoms of the material and a helium atom. Poreblazer \cite{ongari2017accurate}. We measure the accessible void, that is, the total amount of free space in the material and it is a quantity that can be measured experimentally. 
			
	The pore volume is obtainable experimentally under the assumption that Gurvich rule is valid, it assumes that the density of the saturated nitrogen in the pores is equal to its liquid density, independent of the internal void network. 
%	It states that "if the density of the saturated nitrogen in the pores is assumed equal to its liquid density, regardless of the shape of the internal void network and, because of the weak interactions, regardless of the chemistry of the framework." 
and the pore volume ($v_{pore}$) and the porosity ($\theta$) can be  computed from:

\begin{equation}
v_{pore} = \frac{n^{ads,satd}_{N_2}}{\rho^{liq}_{N_2}}
\end{equation}
\begin{equation}
\theta = v_{pore} \cdot \rho_{cryst}
\end{equation} 

	Where $n^{ads,satd}_{N_2}$ is the specific amount of nitrogen adsorbed, $\rho^{liq}_{N_2}$ is the density of liquid nitrogen, and $\rho_{cryst}$ is the density of the crystal in question. It is important to understand that these experimental values does not account for all small voids between atoms where the nitrogen does not fit. There also exists pores that are non accessible for a nitrogen atom, so the experimental data using nitrogen is different form the DFT calculations using i.e. helium.

	There are many different computational method to obtain the pore volume where each one computes slightly different portions of the full volume. We have here used two approaches for measuring the pore volume. Frist, the geometric pore volume,$\text{Ge}_{pv}$, which is defined as all the free volume of the unit cell. Secondly helium pore volume ,$\text{He}_{pv}$, where the unit cell is probed with realistic intermolecular potential is tested. This makes the calculations temperature dependent. The calculation are done at $\SI{298}{K}$, more details on these calculations can be found in the file \href{https://github.com/sondrt/Creten_Stuff/blob/master/defaults.dat}{default.dat} in the supportive information/github.

	Void Fraction is a characterization method for microporous crystals and have had great success in metal organic frameworks (MOFS), as demonstrated also by the team of supervisors.
	
	In case of dens materials like the one we consider in this work, the void fraction should not be a good predictor. However we decided to include it in our tests in case the space occupied by the ion in the discharged material would impact our prediction, as will be discussed later. (REF)\myworries{rewrite.}


UFF \cite{rappe1992uff}

\subsection{AP-RDF Descriptors of Electrode materials}

	Atomic property weighted radial distribution function (AP-RDF)\ref{fernandez2013atomic} was found to be a good predictor which also, when tested by the PCA(REF to theory part), exhibited good discrimination of geometrical and other properties, in one of their cases, gas uptake.
	
	One of the methods found, that seemed to yield good predictions dependent on chemical properties where the Atomic property weighted radial distribution function, successfully used on MOFS. \ref{fernandez2013atomic} Due to it looking reasonable we decided to try it out.

	The radial Distribution Function(RDF) is the interatomic separation histogram representing the weighted probability of finding a pair of atoms separated by a given distance.(REF) In a crystalline solid, the RDF plot has an infinite number of sharp peaks where the separation and height are characteristic of the lattice structure. We used the minimum image convention (boundary condition)\myworries{Do I need a ref here?} and the RDF scores will be uniquely defined inside of the unit cell, per material-ID. The RDF can be expressed as:
\begin{equation}\label{eq:RDF}
RDF^P(R) = f \sum^{\text{all atom pairs}}_{i,j} P_i P_j e^{-B(r_{ij} - R)^2}
\end{equation}

In our case the RDF scores in a electrode framework has been interpreted as the weighted probability distribution to find a atom pair in a spherical volume of radius $R$ inside the unit cell according to equation above. \ref{eq:RDF}

Summing over all the atom pairs, where $R_{ij}$ is the minimum image convention distance of these pairs, $B$ is a smoothing parameter, and $F$ is a scaling or normalization factor. Our Own approach to this is written in Fortran, and can be found in the appendix with an operational pdf.(REF)

The RDF can be weighted to fit the requirements of the chemical information to be represented, by introducing the atomic properties, $P_i$ and $P_j$. We weighted the radial probabilities by three tabulated atomic properties namely electronegativity, polarizability, and Van der Waals volume, which gives us the AP-RDF. While a regular RDF function encodes geometric features, the atomic property weighted RDF additionally characterizes the chemical features within a material. An atomic property weighted RDF can be seen on the screen. 

To test our method, we used it to reproduce the results for the two MOFS, namely \textit{IRMOF-1} and \textit{MIL-45} found in the article by Fernandez.\ref{fernandez2013atomic}. We confirmed their findings .. though with drawback related to the size... which are flawed in our case.  In our opinion, we think that this is a fundamental drawback, and the results depends on the size of the simulation cell(which can be made by replicating the unit cell). 

INSERT BILDET AV PLOT AV AP-RDF. 

\subsection{Algorithm}

First of all, a wrote a program for "scraping" the \textit{materialsproject}webpage for batteries(0). This gave us the possibility to gather all the available resources on the batteries in the database in a fast and effective manor, as well as updating these CSV files of  battery-IDs. (ref)

We then run a second program that downloads all the information on the materials that matches a material-ID correlated to a battery-ID (1,2). (ref) Before constructing a CIF file structured so that all the battery-IDs, charged-material-IDs, and dischargerd-material-IDs are correlated with the information on the charged and discharged properties. 

After, the volumetric density fraction is calculated(3) and added to the main CSV file for both charged and discharged materials. While the CIF files are being processed for Poreblazer(4) where the void fraction is calculated(5,6). 

Then we merge all our CSV files based on what properties that we are interested in and makes a CSV file called for\_ML.csv(7,8) that we feed into our random forest algorithm(9). We then run cross validation, MSE, and plot what we are interested in(10).

In addition we also tested for different machine learning algorithms, as mentioned(ref), but these were only to test the reliability of our model, and will be discussed in the discussion section(ref) 





\begin{comment}
\myworries{This is in the intro.}
The original plan was to make a model that could predict Ionic conductivity for potential solid state electrolytes but after gathering and searching for information we found this article (REF:) by Sendek: Were they could not find a sufficient amount of data on ionic conductivity for a proper model to be created, or rather, they only found 40 materials that they used to make their prediction on ionic conductivity, something that our group deemed far to little for a proper prediction, even if we added the $ 40$ that we found from our own search. 

We then tried to use the materialsproject's database (MPDB), which resulted in a change of focus from electrolytes to electrodes, due to the nature of that database and ML's demand for as much relevant data as possible.

The MPDB included much information on electrodes that came to good use. First and foremost an organized list over reduction cell formulas, CIF files and Voltage pair properties, including, but not limited to; Energy above hull as an indicator of stability, Volume change of the battery, Capacity, both gravimetric and volumetric, and Voltage - of the specific pair. All of these are of interest to our model both as predictors and targets. 

We wrote a highly versatile code that can easily run a random forest algorithm on whatever we deem fit as a target with what predictors to use. (see section; 'Random forest')

From the CIF files we calculated the number density\myworries{ref?}, for both the charged and discharged - materials, which is the number of one particular atom in the unit cell and dividing it by the volume of the unit cell so that we could feed our machine with something that represented the density in a meaningful way, in the case that the machine would find any correlation between this and any of the chosen targets. Which it did. 
\end{comment}


\pagebreak

\myworries{maybe add this in the appendix?}
\begin{lstlisting}[basicstyle=\footnotesize]
Algorithm: 
Steps for use of python scripts:

	mp_battery_scraper.py
0:  Scrape batteries with a given working ion from the Materials Project battery explorer 
(https://www.materialsproject.org/#search/batteries)


	fillproperties.py
1:  Download all materials that match a material_id correlated to a battid.
	Output files: directory cif_info_dir/<material_id>_prop.dat

	add_features.py
2:  Gets and adds the material specific features from the JSON dump to a csv.
	Output files: material_properties.csv

	elements.py
3:  Calculate the density fractions for all materials. 
	Output files: out_csv_dis.csv

	forPoreblazer.py
4:  Download the CIF files as JSON for all materials correlated to a battid. 
	Output files: directory cif_for_poreblazer/<material_id>_cif.dat

	process_cif.py
5:  Extract the CIF information from the previous JSON data.
	Output files: directory cif_for_poreblazer/cif_files/<material_id>_cif.dat.csv

	process_cif.py
6:  Extract void fraction with poreblazer using the CIF files.
	Output files: helvol_geomvol.csv 
	
	merger.py
7:  Merge charged and discharged for all properties
	Output files: allFiles.csv

	prep_csv.py
8:  Select predictors and targets for ML
	Output files: for_ML.csv

	randomforest.py
9:  Run randomforrest
	Output files: Depending on what being saved: ./Results/*
	
	crossvalidation.py
10: Run cross-validation, remove outliers.
	
11: ???

12: Profit!
\end{lstlisting}













